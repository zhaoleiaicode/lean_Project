# 猜数字游戏：

### **一、首先创建一个文件夹，结构如下:**

GuessGame/
├── CMakeLists.txt        <-- 整个工程的“说明书”
├── common/               <-- 存放公用的代码（头文件）
│   └── protocol.h
├── server/               <-- 服务端代码
│   └── main.cpp
└── client/               <-- 客户端代码
    └── main.cpp

```cpp
├── client
│   └── main.cpp
├── CMakeLists.txt
├── common
│   └── protocol.h
└── server
    └── main.cpp
```

------

### 二、编写代码

#### A. 公用头文件：`common/protocol.h`

作用是定义服务器和客户端交流的“语言”。

```
#ifndef PROTOCOL_H
#define PROTOCOL_H
//定义简单的额消息结构
struct GameMessage{
	int guess ;//玩家猜的数字
	int status; //0: 继续, 1: 太小, 2: 太大, 3: 猜中了
}
#endif
```

#### B. 服务端：`server/main.cpp`

负责逻辑处理。注意它是如何引用 `protocol.h` 的。

```
#include <iostream>
#include <netinet/in.h>
#include <unistd.h>
#include "../common/protocol.h"  // 引用头文件

int main(){
	int server_fd = socket(AF_INET,SOCK_STREAM,0);
	sockaddr_in address;
	address.sin_family = AF_INET;
	address.sin_addr.s_addr = INADDR_ANY;
	address.sin_port = htons(8080);
	
	bind(server_fd, (struct sockaddr*)&address, sizeof(address));
	listen(server_fd, 3);
	std::cout << "服务端已启动，等待玩家连接..." << std::endl;
	int target = 42; // 固定的目标数字
	int addrlen = sizeof(address);
	int new_socket = accept(server_fd, (struct sockaddr*)&address, (socklen_t*)&addrlen);
	
	GameMessage msg;
	while (read(new_socket, &msg, sizeof(msg))) {
		if(msg.guess < target){
			msg.status = 1;
		}else if(msg.guess > target){
			msg.status = 2;
		}else{
			msg.status = 3;
		};
		send(new_socket, &msg, sizeof(msg), 0);
		if (msg.status == 3){
			break;
		} 
	}
}
```

#### C. 客户端：`client/main.cpp`

```
#include <iostream>
#include <arpa/inet.h>
#include <unistd.h>
#include "../common/protocol.h"

int main() {
    int sock = socket(AF_INET, SOCK_STREAM, 0);
    sockaddr_in serv_addr;
    serv_addr.sin_family = AF_INET;
    serv_addr.sin_port = htons(8080);
    inet_pton(AF_INET, "127.0.0.1", &serv_addr.sin_addr);

    connect(sock, (struct sockaddr*)&serv_addr, sizeof(serv_addr));

    GameMessage msg;
    while (true) {
        std::cout << "请输入你的猜测: ";
        std::cin >> msg.guess;
        send(sock, &msg, sizeof(msg), 0);
        
        read(sock, &msg, sizeof(msg));
        if (msg.status == 1) std::cout << "太小了！" << std::endl;
        else if (msg.status == 2) std::cout << "太大了！" << std::endl;
        else {
            std::cout << "恭喜你，猜中了！" << std::endl;
            break;
        }
    }
    close(sock);
    return 0;
}
```

#### 3. CMakeLists.txt：重点理解在这！

```
这是最核心的部分。它告诉编译器：我有两个程序要生成，它们都要用到 common 文件夹。
```

```
# 1. 基础设定
cmake_minimum_required(VERSION 3.10)
project(GuessGame)
# 2. 设置 C++ 标准
set(CMAKE_CXX_STANDARD 11)
# 3. 让编译器能找到 common 目录下的头文件
include_directories(common)
# 4. 定义服务端程序
# 将 server/main.cpp 编译成名为 "GameServer" 的可执行文件
add_executable(GameServer server/main.cpp)
# 5. 定义客户端程序
# 将 client/main.cpp 编译成名为 "GameClient" 的可执行文件
add_executable(GameClient client/main.cpp)
```

#### 4. 如何运行？

在终端输入以下命令：

编译:

mkdir build && cd build &&  cmake .. && make

执行:

```
./build/GameClient 
请输入你的猜测: 1
太小了！
请输入你的猜测: 3
太小了！
请输入你的猜测: 67
太大了！
请输入你的猜测: 45
太大了！
```


